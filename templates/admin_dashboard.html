{% extends "base.html" %}

{% block title %}Admin Dashboard - TaskFlowAI{% endblock %}

{% block content %}
<div class="d-flex" id="wrapper">
    <!-- Sidebar -->
    <div class="bg-dark border-end" id="sidebar-wrapper"
        style="width: 250px; position: fixed; height: 100vh; z-index: 1000;">
        <div class="sidebar-heading text-white border-bottom border-secondary p-3 d-flex align-items-center gap-2">
            <i class="bi bi-shield-lock-fill text-warning"></i>
            <span class="fw-bold">Admin Panel</span>
        </div>
        <div class="list-group list-group-flush pt-3">
            <a href="{{ url_for('admin_dashboard') }}"
                class="list-group-item list-group-item-action bg-dark text-white-50 border-0 py-3 active">
                <i class="bi bi-speedometer2 me-2"></i> Visão Geral
            </a>
            <a href="{{ url_for('admin_users') }}"
                class="list-group-item list-group-item-action bg-dark text-white-50 border-0 py-3">
                <i class="bi bi-people me-2"></i> Usuários
            </a>
            <a href="{{ url_for('admin_financial') }}"
                class="list-group-item list-group-item-action bg-dark text-white-50 border-0 py-3">
                <i class="bi bi-credit-card me-2"></i> Financeiro
            </a>
            <a href="{{ url_for('admin_settings') }}"
                class="list-group-item list-group-item-action bg-dark text-white-50 border-0 py-3">
                <i class="bi bi-gear me-2"></i> Configurações
            </a>
            <div class="mt-auto border-top border-secondary pt-3 mt-3 px-3">
                <a href="{{ url_for('dashboard') }}" class="btn btn-outline-light w-100 btn-sm">
                    <i class="bi bi-arrow-left"></i> Voltar ao App
                </a>
            </div>
        </div>
    </div>

    <!-- Page Content -->
    <div id="page-content-wrapper" style="margin-left: 250px; width: 100%;">
        <!-- Topbar -->
        <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom py-3 px-4">
            <div class="container-fluid">
                <h4 class="mb-0 fw-bold">SaaS Overview</h4>
                <div class="dropdown">
                    <button class="btn btn-light dropdown-toggle d-flex align-items-center gap-2" type="button"
                        id="adminDropdown" data-bs-toggle="dropdown">
                        <div class="bg-danger rounded-circle text-white d-flex align-items-center justify-content-center"
                            style="width: 32px; height: 32px;">
                            <i class="bi bi-person-fill"></i>
                        </div>
                        Admin
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item text-danger" href="{{ url_for('logout') }}">Sair</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container-fluid px-4 py-4">
            <!-- Stats Grid -->
            <div class="row g-4 mb-5">
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="text-muted text-uppercase small fw-bold mb-0">Total Usuários</h6>
                                <div class="bg-primary-subtle text-primary rounded p-2">
                                    <i class="bi bi-people-fill"></i>
                                </div>
                            </div>
                            <h2 class="fw-bold mb-0">{{ stats.total_users }}</h2>
                            <small class="text-success fw-bold"><i class="bi bi-arrow-up"></i> +{{ stats.new_users }}
                                este mês</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="text-muted text-uppercase small fw-bold mb-0">Assinaturas Ativas</h6>
                                <div class="bg-success-subtle text-success rounded p-2">
                                    <i class="bi bi-credit-card-2-front-fill"></i>
                                </div>
                            </div>
                            <h2 class="fw-bold mb-0">{{ stats.active_subs }}</h2>
                            <small class="text-muted">Planos Pagos</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="text-muted text-uppercase small fw-bold mb-0">MRR Estimado</h6>
                                <div class="bg-warning-subtle text-warning rounded p-2">
                                    <i class="bi bi-currency-dollar"></i>
                                </div>
                            </div>
                            <h2 class="fw-bold mb-0">R$ {{ stats.mrr }}</h2>
                            <small class="text-success fw-bold"><i class="bi bi-graph-up"></i> +12% vs mês
                                anterior</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="text-muted text-uppercase small fw-bold mb-0">Ações Completadas</h6>
                                <div class="bg-info-subtle text-info rounded p-2">
                                    <i class="bi bi-check-circle-fill"></i>
                                </div>
                            </div>
                            <h2 class="fw-bold mb-0">{{ stats.total_completions }}</h2>
                            <small class="text-muted">Rituais: {{ stats.active_goals }}</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Users Table -->
            <div class="card border-0 shadow-sm">
                <div
                    class="card-header bg-white py-3 px-4 border-bottom d-flex justify-content-between align-items-center">
                    <h5 class="fw-bold mb-0">Últimos Usuários Cadastrados</h5>
                    <button class="btn btn-sm btn-outline-primary">Ver Todos</button>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="bg-light">
                            <tr>
                                <th class="px-4 py-3 text-muted small text-uppercase">Usuário</th>
                                <th class="py-3 text-muted small text-uppercase">Plano</th>
                                <th class="py-3 text-muted small text-uppercase">Status</th>
                                <th class="py-3 text-muted small text-uppercase">Data Registro</th>
                                <th class="px-4 py-3 text-muted small text-uppercase text-end">Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in recent_users %}
                            <tr>
                                <td class="px-4">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="bg-light rounded-circle d-flex align-items-center justify-content-center fw-bold text-primary"
                                            style="width: 40px; height: 40px;">
                                            {{ user.username[0]|upper }}
                                        </div>
                                        <div>
                                            <div class="fw-bold text-dark">{{ user.full_name }}</div>
                                            <small class="text-muted">{{ user.email }}</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    {% if user.subscription_plan == 'pro' %}
                                    <span
                                        class="badge bg-primary-subtle text-primary border border-primary-subtle px-3 py-1 rounded-pill">Pro</span>
                                    {% elif user.subscription_plan == 'business' %}
                                    <span
                                        class="badge bg-warning-subtle text-warning border border-warning-subtle px-3 py-1 rounded-pill">Business</span>
                                    {% else %}
                                    <span
                                        class="badge bg-secondary-subtle text-secondary border border-secondary-subtle px-3 py-1 rounded-pill">Gratuito</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if user.is_active %}
                                    <span class="d-flex align-items-center gap-2">
                                        <span class="bg-success rounded-circle" style="width: 8px; height: 8px;"></span>
                                        Ativo
                                    </span>
                                    {% else %}
                                    <span class="d-flex align-items-center gap-2">
                                        <span class="bg-danger rounded-circle" style="width: 8px; height: 8px;"></span>
                                        Inativo
                                    </span>
                                    {% endif %}
                                </td>
                                <td class="text-muted">{{ user.created_at.strftime('%d/%m/%Y') }}</td>
                                <td class="px-4 text-end">
                                    <button class="btn btn-sm btn-light border"><i
                                            class="bi bi-three-dots"></i></button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}